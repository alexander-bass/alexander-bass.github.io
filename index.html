<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brown Noise Audio Manipulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        
        .container {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #ff6b6b;
            margin-bottom: 30px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #333;
            padding: 20px;
            border-radius: 8px;
        }
        
        .control-group h3 {
            margin: 0 0 15px 0;
            color: #4ecdc4;
            font-size: 16px;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #ccc;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #555;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: none;
        }
        
        .value-display {
            float: right;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        select {
            width: 100%;
            padding: 8px;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .play-controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #ff5252;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .visualizer {
            background: #222;
            border-radius: 8px;
            height: 200px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        canvas {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ Brown Noise Audio Manipulator</h1>
        
        <div class="play-controls">
            <button id="playBtn">Play</button>
            <button id="stopBtn" disabled>Stop</button>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>Volume Control</h3>
                <div class="slider-container">
                    <label>Master Volume <span class="value-display" id="volumeDisplay">50%</span></label>
                    <input type="range" id="volumeSlider" min="0" max="100" value="50">
                </div>
            </div>
            
            <div class="control-group">
                <h3>Filter Controls</h3>
                <div class="slider-container">
                    <label>Filter Type</label>
                    <select id="filterType">
                        <option value="lowpass">Low Pass</option>
                        <option value="highpass">High Pass</option>
                        <option value="bandpass">Band Pass</option>
                        <option value="notch">Notch</option>
                    </select>
                </div>
                <div class="slider-container">
                    <label>Cutoff Frequency <span class="value-display" id="frequencyDisplay">1000 Hz</span></label>
                    <input type="range" id="frequencySlider" min="20" max="20000" value="1000">
                </div>
                <div class="slider-container">
                    <label>Resonance (Q) <span class="value-display" id="qDisplay">1.0</span></label>
                    <input type="range" id="qSlider" min="0.1" max="30" step="0.1" value="1">
                </div>
            </div>
        </div>
        
        <div class="visualizer">
            <canvas id="visualizer" width="800" height="200"></canvas>
        </div>
    </div>

    <script>
        class BrownNoiseProcessor {
            constructor() {
                this.audioContext = null;
                this.noiseNode = null;
                this.filterNode = null;
                this.gainNode = null;
                this.analyzerNode = null;
                this.isPlaying = false;
                this.animationFrame = null;
                
                this.initializeElements();
                this.setupEventListeners();
            }
            
            initializeElements() {
                this.playBtn = document.getElementById('playBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.volumeDisplay = document.getElementById('volumeDisplay');
                this.filterType = document.getElementById('filterType');
                this.frequencySlider = document.getElementById('frequencySlider');
                this.frequencyDisplay = document.getElementById('frequencyDisplay');
                this.qSlider = document.getElementById('qSlider');
                this.qDisplay = document.getElementById('qDisplay');
                this.canvas = document.getElementById('visualizer');
                this.canvasContext = this.canvas.getContext('2d');
            }
            
            setupEventListeners() {
                this.playBtn.addEventListener('click', () => this.startAudio());
                this.stopBtn.addEventListener('click', () => this.stopAudio());
                
                this.volumeSlider.addEventListener('input', (e) => {
                    const volume = parseInt(e.target.value) / 100;
                    this.volumeDisplay.textContent = `${e.target.value}%`;
                    if (this.gainNode) {
                        this.gainNode.gain.setValueAtTime(volume * 0.3, this.audioContext.currentTime);
                    }
                });
                
                this.filterType.addEventListener('change', (e) => {
                    if (this.filterNode) {
                        this.filterNode.type = e.target.value;
                    }
                });
                
                this.frequencySlider.addEventListener('input', (e) => {
                    const frequency = parseInt(e.target.value);
                    this.frequencyDisplay.textContent = `${frequency} Hz`;
                    if (this.filterNode) {
                        this.filterNode.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    }
                });
                
                this.qSlider.addEventListener('input', (e) => {
                    const q = parseFloat(e.target.value);
                    this.qDisplay.textContent = q.toFixed(1);
                    if (this.filterNode) {
                        this.filterNode.Q.setValueAtTime(q, this.audioContext.currentTime);
                    }
                });
            }
            
            async startAudio() {
                try {
                    // Initialize AudioContext
                    this.audioContext = new AudioContext();
                    
                    // Create brown noise using AudioWorklet or ScriptProcessor fallback
                    await this.createBrownNoise();
                    
                    // Create filter node
                    this.filterNode = this.audioContext.createBiquadFilter();
                    this.filterNode.type = this.filterType.value;
                    this.filterNode.frequency.setValueAtTime(
                        parseInt(this.frequencySlider.value), 
                        this.audioContext.currentTime
                    );
                    this.filterNode.Q.setValueAtTime(
                        parseFloat(this.qSlider.value), 
                        this.audioContext.currentTime
                    );
                    
                    // Create gain node
                    this.gainNode = this.audioContext.createGain();
                    this.gainNode.gain.setValueAtTime(
                        (parseInt(this.volumeSlider.value) / 100) * 0.3, 
                        this.audioContext.currentTime
                    );
                    
                    // Create analyzer for visualization
                    this.analyzerNode = this.audioContext.createAnalyser();
                    this.analyzerNode.fftSize = 256;
                    
                    // Connect audio nodes
                    this.noiseNode.connect(this.filterNode);
                    this.filterNode.connect(this.gainNode);
                    this.gainNode.connect(this.analyzerNode);
                    this.analyzerNode.connect(this.audioContext.destination);
                    
                    // Start visualization
                    this.startVisualization();
                    
                    this.isPlaying = true;
                    this.playBtn.disabled = true;
                    this.stopBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Error starting audio:', error);
                    alert('Error starting audio. Please check your browser permissions.');
                }
            }
            
            async createBrownNoise() {
                // Create brown noise using ScriptProcessorNode (deprecated but widely supported)
                // In production, you'd want to use AudioWorklet for better performance
                const bufferSize = 4096;
                this.noiseNode = this.audioContext.createScriptProcessor(bufferSize, 0, 1);
                
                let lastOut = 0.0;
                
                this.noiseNode.onaudioprocess = (e) => {
                    const output = e.outputBuffer.getChannelData(0);
                    
                    for (let i = 0; i < bufferSize; i++) {
                        const white = Math.random() * 2 - 1;
                        const brown = (lastOut + (0.02 * white)) / 1.02;
                        lastOut = brown;
                        output[i] = brown * 3.5; // Amplify brown noise
                    }
                };
            }
            
            startVisualization() {
                const bufferLength = this.analyzerNode.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                const draw = () => {
                    if (!this.isPlaying) return;
                    
                    this.animationFrame = requestAnimationFrame(draw);
                    
                    this.analyzerNode.getByteFrequencyData(dataArray);
                    
                    this.canvasContext.fillStyle = '#222';
                    this.canvasContext.fillRect(0, 0, this.canvas.width, this.canvas.height);
                    
                    const barWidth = (this.canvas.width / bufferLength) * 2.5;
                    let barHeight;
                    let x = 0;
                    
                    for (let i = 0; i < bufferLength; i++) {
                        barHeight = (dataArray[i] / 255) * this.canvas.height;
                        
                        const red = Math.floor((dataArray[i] / 255) * 255);
                        const green = Math.floor((dataArray[i] / 255) * 100);
                        const blue = Math.floor((dataArray[i] / 255) * 150);
                        
                        this.canvasContext.fillStyle = `rgb(${red}, ${green}, ${blue})`;
                        this.canvasContext.fillRect(x, this.canvas.height - barHeight, barWidth, barHeight);
                        
                        x += barWidth + 1;
                    }
                };
                
                draw();
            }
            
            stopAudio() {
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
                
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                }
                
                this.isPlaying = false;
                this.playBtn.disabled = false;
                this.stopBtn.disabled = true;
                
                // Clear canvas
                this.canvasContext.fillStyle = '#222';
                this.canvasContext.fillRect(0, 0, this.canvas.width, this.canvas.height);
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new BrownNoiseProcessor();
        });
    </script>
</body>
</html>